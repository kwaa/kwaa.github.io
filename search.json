[{"title":"本地和 CF Worker 的 Hexo 搜索引擎实践","url":"/p/hexo-search/","content":"\nTheme-M 最近进度不错，就打算把旧版的本地搜索移植过来再加个 Worker 搜索。\n\n## 用 hexo-generator-search 生成索引\n\n剩下的内容都需要用到它。在 Hexo 目录下用 npm 安装：\n\n```bash\nnpm i hexo-generator-search\n```\n\n然后在站点配置文件 ```_config.yml``` 写入如下配置：\n\n```yaml\nsearch:\n    path: search.json # 生成 JSON 文件\n    content: true # 包括文章内容\n```\n\n执行一下 ```hexo g```，public 目录里出现 search.json 就代表正常工作。\n\n## 本地搜索\n\n还是那么些东西，但我真的很不想在自己的主题里放一个带一大串注释的 search.js，于是索性重新写了一份。\nES6+ 香到我直接不用 mdui.JQ 了。\n\n```html\n<form onkeydown=\"if (event.keyCode == 13) return false\" class=\"mdui-textfield mdui-m-b-2\">\n    <i class=\"mdui-icon material-icons\">search</i>\n    <input id=\"local-input\" type=\"search\" name=\"q\" class=\"mdui-textfield-input\"\n        placeholder=\"<%= __('common.search') %>\" disabled>\n</form>\n<div id=\"local-result\" style=\"min-height:100vh; transition: all .4s\" class=\"mdui-list\">\n</div>\n<script>\n    fetch(`<% if(theme.search.local.url) { %><%- theme.search.local.url %><% } else { %><%- url_for('search.json') %><% } %>`)\n        .then(res => res.json()).then(data => {\n            document.getElementById('local-input').disabled = false\n            document.getElementById('local-input').addEventListener('input', () => {\n                let keyword = document.getElementById('local-input').value.trim().toLowerCase()\n                document.getElementById('local-result').innerHTML = ''\n                if (keyword.length <= 0) return\n                data.forEach(({title, content, url}) => {\n                    const appendPost = content => document.getElementById('local-result').insertAdjacentHTML('beforeend', `\n                        <a href=${url} class=\"mdui-list-item mdui-ripple\">\n                            <div class=\"mdui-list-item-content\">\n                                <div class=\"mdui-list-item-title mdui-list-item-one-line\">${title}</div>\n                                <div class=\"mdui-list-item-text mdui-list-item-two-line\">${content}</div>\n                            </div>\n                        </a>`)\n                    if (content.toLowerCase().includes(keyword)) appendPost(content.substring((content.toLowerCase().indexOf(keyword) - 9), (content.toLowerCase().indexOf(keyword) + 130)))\n                    else if (title.toLowerCase().includes(keyword)) appendPost(content.substring(0, 139))\n                })\n            })\n        })\n</script>\n```\n\n完成。逻辑基本和原来差别不大，但 JS 只有不到 20 行。\n\n## Worker 搜索\n\n灵感来自 [cloudflare workers实现静态网站全站搜索 - zcmimi's blog](https://blog.zcmimi.top/posts/cloudflare%20workers%E5%AE%9E%E7%8E%B0%E9%9D%99%E6%80%81%E7%BD%91%E7%AB%99%E5%85%A8%E7%AB%99%E6%90%9C%E7%B4%A2)，针对 Hexo 进行了重写。\n\n后来想起来旧主题自己曾经写过一个 Google Custom Search JSON API (以下简称 google-json) 的模板，就有了一个想法：为什么我不能直接拿来用呢？\n\n所以 Worker 后端的目标就是和 google-json 格式一致，并且能处理多个 Hexo 站点的搜索。\n\n### 格式\n\n请求地址：\n\n```plain\nhttps://*.workers.dev/?siteSearch=站点&q=关键字\n```\n\n返回 JSON：\n\n```json\n{\n    \"items\": [\n        {\n            \"title\": \"标题1\",\n            \"link\": \"链接1\",\n            \"snippet\": \"描述1\"\n        },\n        {\n            \"title\": \"标题2\",\n            \"link\": \"链接2\",\n            \"snippet\": \"描述2\"\n        }\n    ]\n}\n```\n\n只有这点内容，也只需要这点内容。\n\n### index.js\n\n那么首先定义一下 json 文件常量和存储，\n如果 URL 参数填写了 siteSearch 则直接使用，没有就用对象里第一个值。\n\n```javascript\nconst file = {\n    \"kwaa.dev\": \"https://kwaa.dev/search.json\",\n    \"https://kwaa.dev\": \"https://kwaa.dev/search.json\"\n}\nlet data = {}\n\naddEventListener('fetch', event => {\n    event.respondWith(handleRequest(event.request))\n})\n```\n\n定义 getdata 和 search 函数，搜索部分我直接把上面本地搜索部分移植了一下。\n\n```javascript\nasync function getdata(searchSite) {\n    await fetch(searchSite).\n        then(res => res.json()).\n        then(json => data[searchSite] = json)\n}\nasync function search(searchTerm, searchSite) {\n    searchTerm = JSON.parse('\"' + searchTerm.trim().toLowerCase() + '\"')\n    if (!data[searchSite]) await getdata(searchSite)\n    let res = { \"items\": [] }\n    data[searchSite].forEach(({ title, content, url }) => {\n        const push = (content) => res.items.push({\n            \"title\": title,\n            \"link\": url,\n            \"snippet\": content\n        })\n        if (content.toLowerCase().includes(searchTerm)) push(content.replace(/<[^>]+>/g, \"\").substring((content.toLowerCase().indexOf(searchTerm) -9), (content.toLowerCase().indexOf(searchTerm) + 130)))\n        else if (title.toLowerCase().includes(searchTerm)) push(content.replace(/<[^>]+>/g, \"\").substring(0, 139));\n    })\n    return JSON.stringify(res);\n}\n```\n\n最后是 handleRequest：\n\n```javascript\nasync function handleRequest(request) {\n    const { searchParams } = new URL(request.url)\n    let searchTerm = searchParams.get('q'), searchSite\n    if (searchTerm == '') {\n        return new Response(\"usage:\\n\\\n        ?siteSearch=<site>&q=<keyword>\\n\\\n        required: q\", { status: 404 })\n    }\n    if (searchParams.get('siteSearch')) {\n        searchSite = site[searchParams.get('siteSearch')]\n    } else {\n        searchSite = Object.values(site)[0]\n    }\n    return new Response(await search(searchTerm, searchSite), {\n        status: 200,\n        headers: new Headers({\n            'access-control-allow-origin': '*',\n            'access-control-allow-methods': 'GET,POST,PUT,PATCH,TRACE,DELETE,HEAD,OPTIONS',\n            'access-control-max-age': '1728000',\n        }),\n    })\n}\n```\n\n那么在页面里显示结果：\n\n```html\n<form action=\"servlet\" method=\"post\" onsubmit=\"return searchAPI(this.searchTerm.value);\" class=\"mdui-textfield mdui-m-b-2\">\n    <i class=\"mdui-icon material-icons\">search</i>\n    <input id=\"searchTerm\" type=\"search\" name=\"q\" class=\"mdui-textfield-input\"\n        placeholder=\"<%= __('common.search') %>\">\n</form>\n<div id=\"api-result\" style=\"min-height:100vh; transition: all .4s\" class=\"mdui-list\">\n</div>\n<script>\n    function searchAPI(searchTerm) {\n        fetch(`https://search.kwaa.workers.dev/?q=${searchTerm}<% if(theme.search.api.site !== false) { %>&siteSearch=<% if(theme.search.api.site == '') { %><%= config.root %><% } else { %><%= theme.search.api.site %><% }} if (theme.search.api.key && theme.search.api.id) { %>&key=<%= theme.search.api.key %>&cx=<%= theme.search.api.id %><% } %>`)\n        .then(res => res.json()).then(json => json.items.forEach(({title, link, snippet}) => document.getElementById('api-result').insertAdjacentHTML('beforeend', `\n            <a class=\"mdui-list-item mdui-ripple\" href=\"${link}\">\n                <div class=\"mdui-list-item-content\">\n                    <div class=\"mdui-list-item-title mdui-list-item-one-line\">${title}</div>\n                    <div class=\"mdui-list-item-text mdui-list-item-two-line\">${snippet}</div>\n                </div>\n            </a>`)\n        ))\n        return false;\n    }\n</script>\n```\n\n所以 Theme-M 可以直接使用 google-json 并修改 url 以支持 Worker 搜索引擎；其他适配 google-json 的 Hexo 主题也可以如此套用，真是太好了。~~但是真的有 Hexo 主题适配这种玩意吗？~~\n\n那么本文在这里结束，欢迎体验 Hexo Theme-M。~~虽然还在更新，但 repo 已经很久不动了~~\n","tags":["Hexo","Theme-M"],"categories":["折腾"]},{"title":"Pleroma 安装笔记","url":"/p/pleroma/","content":"本来想搭建 Mastodon 的，但它配置要求较高——出于~~省钱~~节俭原则，我长期部署的网站基本都是零成本（不包括域名）。甲骨文提供的两台小鸡都是1C1G，怎么办呢？\n这时我看到了 [Pleroma](https://pleroma.social/)。<!-- more -->\n\n## 在开始之前\n\n- 推荐阅读: [What Is Pleroma?](https://blog.soykaf.com/post/what-is-pleroma/)\n- 本文使用 Debian testing (bullseye) amd64 系统的 root 账户进行操作，并已先行安装 caddy v2。\n- 安装方式参考 [Installing on Linux using OTP releases](https://docs-develop.pleroma.social/backend/installation/otp_en)。\n\n为什么我不用 Twitter? 这几年 Twitter 芝麻仁越来越多了，我希望有一块能让我自由发言且没有芝麻仁的净土。\n\n首先按照惯例更新一下系统和安装软件包。\n\n```bash\napt update && apt full-upgrade && apt install sudo curl unzip libncurses5 postgresql postgresql-contrib\n```\n\n## 安装 Pleroma\n\n添加新用户：\n\n```bash\nuseradd -r -s /bin/false -m -d /opt/pleroma -U pleroma\n```\n\n下载并安装：\n\n```bash\nmkdir -p /opt/pleroma && chown -R pleroma /opt/pleroma\ncurl 'https://git.pleroma.social/api/v4/projects/2/jobs/artifacts/stable/download?job=amd64' -o /tmp/pleroma.zip && unzip /tmp/pleroma.zip -d /tmp/ && mv /tmp/release/* /opt/pleroma && rmdir /tmp/release && rm /tmp/pleroma.zip\n```\n\n创建上传，静态文件和配置文件夹：\n\n```bash\nmkdir -p /var/lib/pleroma/uploads && mkdir -p /var/lib/pleroma/static && chown -R pleroma /var/lib/pleroma\nmkdir -p /etc/pleroma && chown -R pleroma /etc/pleroma\n```\n\n生成配置并确认（注意检查 PostgreSQL 密码）：\n\n```bash\nsu pleroma -s $SHELL -lc \"./bin/pleroma_ctl instance gen --output /etc/pleroma/config.exs --output-psql /tmp/setup_db.psql\"\nsu postgres -s $SHELL -lc \"psql -f /tmp/setup_db.psql\"\nsu pleroma -s $SHELL -lc \"./bin/pleroma_ctl migrate\"\n```\n\n启动 Pleroma！之后用 curl 检测一下，有 JSON 输出的话就 OK 了。\n\n```bash\nsu pleroma -s $SHELL -lc \"./bin/pleroma daemon\" && sleep 20 && curl http://localhost:4000/api/v1/instance\n```\n\n## Caddy 反代\n\n怎么用 Caddy 我就不在这里说了。直接丢 Caddyfile：\n\n```plain\n:443, me.kwaa.moe\ntls example@sld.tld\nroute {\n    reverse_proxy 127.0.0.1:4000\n}\n```\n\n成果就是 [me.kwaa.moe](https://me.kwaa.moe)，不知道能活到什么时候（请别打）。\n\n## 尾声\n\n我又接触到了一种数据库和一种语言（方言？）。\n数据库这方面我已经累了；但 Elixir 有点感兴趣，以后了解一下。\n本来打算装个 Soapbox-FE，但完成度不是很高就删掉了。\n搭完是挺有成就感，不过感觉不太用得到？**毕竟社交力基本为零**\n","tags":["Pleroma","Fediverse"],"categories":["笔记"]},{"title":"Knowles & Sonion 动铁笔记","url":"/p/balanced-armature/","content":"\n我对于部分型号动铁的记录，能找到 PDF 的会附上 PDF 地址；描述均为个人印象，不保证准确。\n排序根据个人喜好和接触时间加权，没有内容就是想写但还没写。<!-- more -->\n\n## 全频单元\n\n### K ED-29689 [PDF](https://https://www.knowles.com/docs/default-source/model-downloads/ed-29689-000.pdf)\n\n最典型的全频/中频单元，我不怎么喜欢但它确实认知度最高。\n变种：\n\n- ED-26821 开孔\n- ED-26805 不明\n\n### S 2389 [PDF](https://www.sonion.com/wp-content/uploads/2389-3002874.pdf)\n\n我永远喜欢 2300 系列。2389 是在 2323 基础上增加半线圈的型号；和 29689 适用范围相似但高频延展更好，也要柔和一些。\n\n### S 2354 开孔 [PDF](https://www.sonion.com/wp-content/uploads/2354-3016530.pdf)\n\n开孔型号，主要用在全频单动铁耳机。\n它曾经是单动铁的神，现在或许还是。\n\n### K RAB-32257 [PDF](https://media.digikey.com/pdf/Data%20Sheets/Knowles%20Acoustics%20PDFs/RAB-32257-000.pdf)\n\n第一次接触 32257 是去年的 F7200 壳了，做完之后除了还行以外说不出别的。总之就是个还算可以的单动铁？但 2354 降到 45 之后我觉得它没有存在价值了。~~肛管舞耳机御用单元（笑）~~\n\n## 低频单元\n\n### S 38D1XJ007Mi/8a 复合 开孔 阻尼 [PDF](https://www.sonion.com/wp-content/uploads/38D1XJ007Mi-8a-3202936.pdf)\n\n一流低频！内置 Acupass 阻尼，强劲而不好调。\n\n### K CI-22955\n\n经典款。我之前用的四单元/五单元塞子低频都用它，只能说是中规中矩吧。\n变种：\n\n- CI-32984 开孔\n\n### K HODVTEC-31618\n\n## 中频单元\n\n### S 33AP007 复合\n\n### S 33AJ007i 复合\n\n### S 37AP007 复合\n\n### S 28UAP01 复合\n\n### K RDA-32792 复合\n\n## 中高频单元\n\n### S 2389D 复合 [PDF](https://www.sonion.com/wp-content/uploads/2389D-3200615.pdf)\n\n两个 2389 并管为 2389D，最爱的中高频单元。~~别问我单单元是全频为什么复合就放中高频了，问就是我的偏心~~\n\n### K TWFK-30017 复合 开孔 [PDF](https://www.knowles.com/docs/default-source/model-downloads/twfk-30017-000.pdf)\n\n你没看错，30017 (里面的 30018) 是开孔单元。它真的很小！\n多见于圈铁，纯动铁用的不多。（CK100 / Noble Kaiser?）它由 FK-30018 和 WBFK-30019 复合，这个看到这里的人应该都知道了。\n我的两个方案都以 30017 作中高频，一对 30017 还作为 MIDORI 的原料在原件盒里躺着。但我还没听过，所以现在不过多评价。\n变种：\n\n- TWFK-23991 阻抗更高\n- TWFK-31082 串电容？\n- TWFK-60232 (UE) 类似31082\n- TWFK-60519 (AKG) 不明\n\n## 极高频单元\n\n### S EST65DA01 复合 静电\n\n~~然而这不是动铁~~\n因为我第一个高端耳机是 AXE_P8，所以 EST65DA01 是我第一个接触的极高频单元。它贵，它声压低，它只能做极高，但它是静电所以我爱它。如果你想用这玩意，建议配个 2389D。\n\n### S EST65QB02 复合 静电\n\n~~然而这也不是动铁~~\n传说中的一拖四，但我的荷包已经菠萝菠萝哒！\n没钱买自然没办法体验，先放这里了。\n\n### K SWFK-31736 复合\n\n### K SWFK-32254 复合 阻尼\n\n### K SWFK-32625 复合 阻尼\n\n### K WBFK-30095\n\n### K RAD-33518\n\n飞傲说 33518 和 30095 几乎是一样的单元，这样的话 35 元的价格可以说性价比很高了。\n","tags":["DIY","IEM","平衡电枢"],"categories":["音频"]},{"title":"とある簡単なスクリプト - naive.sh","url":"/p/naive-sh/","content":"花几天功夫写了个 NaiveProxy 脚本，就是这样。\n[kwaa/naive.sh](https://github.com/kwaa/naive.sh)\n\n## 设计说明\n\n我写它就是用来自动更新 NaiveProxy。\n后来我想了想，不如干脆把功能写完整发上来吧？于是就有了这玩意。\n它不会像[某脚本](https://github.com/233boy/v2ray)一样搞墙外墙，且不会保存在本地以避免产生垃圾 & 确保你每次使用都是最新版本。\n\n## 如何使用\n\n``` bash\nbash <(wget -qO- https://git.io/naive.sh) #正常模式\nbash <(wget -qO- https://git.io/naive.sh) update #自动更新naiveproxy\n```\n\n## 要求\n\nLinux, x86 或 x86_64\n以 root 运行\n已安装 wget 和 libnss3\n没了。它只做它该做的事，依赖什么的就请自己解决吧。\n\n## 待做\n\n- 快速安装 & 自动配置 Caddy v2 + forwardproxy\n- 支持 linux-arm, linux-arm64\n- 包管理器为 pacman, apt, yum 其一时自动安装依赖\n\n## 许可证\n\n随手写的小玩意我必用 WTFPL\n","tags":["NaiveProxy"],"categories":["折腾"]},{"title":"一年后的成果：STREIN IEM-AXE_P8","url":"/p/project-axe-p8/","content":"经过十五天，IEM-AXE 吃灰了一年的十六个单元做成耳机回到了我手上。\n怎么说呢？虽然处处妥协，但它确实是我第一个原创耳机。\n由于是单边八单元（静电一拖二而非一拖四），我命名为 PROTOTYPE8，也叫P8。\n\n<!-- more -->\n\n频响：\n\n![Frequency Response 1/24](https://cdn.jsdelivr.net/gh/kwaa/kwaa.github.io/source/_posts/project-axe-p8/fr.png)\n\n听感没什么好说的，人声较远 / 低频略多以外基本满意（话说我也没同档次耳机对比）；100Hz 以下匹配不好大概是单元补焊点导致的。\n\n> IEM-AXE_P8 (最终设计) 8单元 4分频 3导管 金属嘴\n\n- 38D1XJ007Mi(并联) - 并4.7Ω+2.2uF - 并管黄阻尼(4700) - 10mm*1.5mmID\n- 33AJ007i(并联) - 串10Ω - 并管黄阻尼(4700) - 10mm*1.5mmID\n- 2389D(半线圈并联) - 串2.2uF, 并1uF - 棕阻尼(1000) - 8mm*1.5mmID\n- EST65QB02(并联) - 串470nF - 白阻尼(680) - 5mm*1.5mmID\n\n方案如上，这是 IEM-AXE_P8 的最终设计，但不是 IEM-AXE 的最终设计；我之后会尽量给它画上一个完美的句号。\n\nSpecial Thanks: Mirzoid (STREIN Member，本次负责耳机制作 & 部分分频)\n","tags":["DIY","IEM","入耳式耳机"],"categories":["音频"]},{"title":"Hexo 流水线 & 相关","url":"/p/github-actions-for-hexo/","content":"\n去年只有一个 yaml 的文章居然追加了这么多内容？不管怎么样，能多写点东西我是很高兴了。\n\n<!-- more -->\n\n## 301 跳转\n\n这个博客之前的域名是 [https://blog.917.moe](https://blog.917.moe)，现在换成了 [https://kwaa.dev](https://kwaa.dev)。\n怎么让旧链接跳转呢？我写了一个 Worker 来做这件事。\n这里要吹一波 Cloudflare，CDN 和 Worker 都可以免费使用。\n虽然原域名过两个月就到期了，能用一会是一会吧。\n\n``` js\naddEventListener('fetch', event => {\n  let url = new URL(event.request.url);\n  const redirectTo = 'kwaa.dev';\n  url.hostname = redirectTo;\n  event.respondWith(\n    Response.redirect(url, 301)\n  )\n})\n```\n\n## PWA\n\n去年还是 manifest.json，今年就变成了 manifest.webmanifest。\n新的 maskable_icon 我肯定要用，其他貌似没太大变化？\n和上次一样，[manifest](https://github.com/kwaa/kwaa.github.io/blob/master/source/manifest.webmanifest) 和 [sw.js](https://github.com/kwaa/kwaa.github.io/blob/master/source/sw.js) 都是我自己写的，没用那些乱七八糟的插件。不过图片缓存不知道为什么无效？以后再改改看吧。\n\n## Instant View\n\n我经常用 Telegram，当然也想让自己的博客能兼容 Instant View。\n不过实际上应该说是 Instant View 兼容我的博客？\n总之 Theme M 需要写的部分不是很多，下面是本站的模板文件。\n\n``` plain\n~version: \"2.1\"\nbody:    //article\ncover: $body//div[has-class(\"mdui-card-media\")]//img\nchannel: \"@kwaachannel\"\n@remove: $body//a[has-class(\"mdui-btn\")]\n@remove: $body//a[has-class(\"mdui-card-primary-title\")]\n@remove: $body//div[has-class(\"mdui-card-primary-subtitle\")]\n```\n\n在 [My Templates - Instant View](https://instantview.telegram.org/my) 创建新模板，标记十个或更多 URL 后即可提交。\n\n## Gulp & Github Actions 自动部署\n\nkwaa.dev 的配置加入了 gulp ，并且全面更新了依赖版本。\n因为 [Theme M](https://github.com/kwaa/m) 设计之初就**没有放在本地的 css,js 文件**，所以也不需要 gulp-clean-css 和 gulp-uglify。\n\n安装：\n\n``` bash\nnpm i gulp -g\nnpm i gulp gulp-htmlclean gulp-htmlmin gulp-minify-inline\ngulp -v\n```\n\n在博客根目录创建 gulpfile.js:\n\n``` js\nlet gulp = require('gulp');\nlet htmlmin = require('gulp-htmlmin');\nlet htmlclean = require('gulp-htmlclean');\nlet minifyInline = require('gulp-minify-inline');\n\n// html\ngulp.task('minify-html', function() {\n    return gulp\n        .src('./public/**/*.html')\n        .pipe(htmlclean())\n        .pipe(htmlmin({\n            removeComments: true,\n            minifyJS: true,\n            minifyCSS: true,\n            minifyURLs: true,\n        }))\n        .pipe(gulp.dest('./public'))\n});\n// inline\ngulp.task('minify-inline', function() {\n    return gulp\n        .src('./public/**/*.html')\n        .pipe(minifyInline())\n        .pipe(gulp.dest('./public'))\n});\n// task\ngulp.task('default', gulp.series(\n    'minify-html','minify-inline'\n));\n```\n\n创建 ./.github/workflows 文件夹，并新建 main.yml:\n\n``` yaml\nname: Build & Deploy ./kwaa.dev\non:\n  push:\n    branches:\n      - master\njobs:\n  build-and-deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v2\n      - name: Use Node.js 14.x\n        uses: actions/setup-node@v2-beta\n        with:\n          node-version: '14'\n          check-latest: true\n      - name: Build\n        run: npm i -g hexo gulp && npm install && hexo generate && gulp\n      - name: Deploy\n        uses: peaceiris/actions-gh-pages@v3\n        with:\n          github_token: ${{ secrets.GH_TOKEN }}\n          publish_branch: gh-pages\n          publish_dir: /public\n```\n","tags":["PWA","Progressive Web Apps","Instant View","Github Actions","Hexo","CI/CD"],"categories":["笔记"]},{"title":"体验 WebAssembly 虚拟机 SSVM","url":"/p/ssvm-nodejs/","content":"\n偶然看到[写 Rust 代码，领树莓派](https://www.v2ex.com/t/693807)\n这种好事怎么能错过？虽然只能领到 Zero W；我本来就对 Rust 比较感兴趣，这次正好尝试一下。\n\n<!-- more -->\n\n先按照[教程](https://www.secondstate.io/articles/get-started-with-rust-functions-in-node-zh/)走吧：\n为了省事我用的 docker，但实际上一点都不省事。\nssvm 要求 Ubuntu 20.04，对我服务器装着的纯血 Arch 不太友好。\n\n``` bash\ngit clone https://github.com/second-state/ssvm-nodejs-starter\ncd ssvm-nodejs-starter\ndocker build -t ssvm-nodejs:v1 . # 需要很长时间，注意\ndocker run -p 3000:3000 --rm -it -v $(pwd):/app ssvm-nodejs:v1\n```\n\n进入开发环境，接下来尝试编译：\n（cargo build 速度感人，这里我推荐使用 proxychains-ng）\n\n``` bash\ncd /app\ncargo build # 需要很长时间，注意\nssvmup build # 我前几次尝试的时候没有执行 cargo package，结果一点反应没有；引以为戒。\nnode node/app.js # 编译完就可以运行了\n```\n\n这是一个 Hello World 示例，跑起来大概这样：\n\n![hello](https://cdn.jsdelivr.net/gh/kwaa/kwaa.github.io/source/_posts/ssvm-nodejs/hello.png)\n\n新手教程已经完成了，我也该着手修改了。\n做点什么呢？Rust 和 WebAssembly 我都是第一次接触。\n考虑到作为初学者不应该写的太大，这里我选择了 leetcode 的 [1374. Generate a String With Characters That Have Odd Counts](https://leetcode.com/problems/generate-a-string-with-characters-that-have-odd-counts/)。\n\n之后我花了两天尝试用 ajaxForm 提交，不过怎么样都是失败。\n\n![web](https://cdn.jsdelivr.net/gh/kwaa/kwaa.github.io/source/_posts/ssvm-nodejs/web.png)\n\n于是就有了现在下面的这个玩意... 反正只说了学习基础知识欸嘿\n\n**lib.rs:**\n\n``` rust\nuse wasm_bindgen::prelude::*;\n\n#[wasm_bindgen]\npub fn sb(s: &str) -> String {\n  let l = s.parse::<i32>().unwrap();\n  let r = \"a\".repeat(l as usize - 1) + if l & 1 != 0 { \"a\" } else { \"b\" };\n  println!(\"The Rust function sb() received {}\", r);\n  return r;\n}\n```\n\n**app.js:**\n\n``` js\nconst { sb } = require('../pkg/ssvm_nodejs_starter_lib.js');\n\nconst http = require('http');\nconst url = require('url');\nconst hostname = '0.0.0.0';\nconst port = 3000;\n\nconst server = http.createServer((req, res) => {\n  const queryObject = url.parse(req.url,true).query;\n  if (!queryObject['length']) {\n    res.end(`Please use command curl http://${hostname}:${port}/?length=LENGTH \\n`);\n  } else {\n    res.end(sb(queryObject['length']) + '\\n');\n  }\n});\n\nserver.listen(port, hostname, () => {\n  console.log(`Server running at http://${hostname}:${port}/`);\n});\n```\n\n这次试手的源码我放在了 [GitHub](https://github.com/kwaa/ssvm-nodejs-starter) 。（然而并没有什么用）\n\n> 顺便一提，sb 指 stringbuilder\n","tags":["Rust","WebAssembly","WASM","Node.js"],"categories":["笔记"]},{"title":"Introducting Theme-M","url":"/p/theme-m/","content":"\nTHEME-M 从 2019 年初创建文件夹，于 2020 年 7 月重写。\n重写后卖相更好+精简依赖项，目前只有 MDUI 必须引用；以至于我的样式补丁直接打在页首。\n新外观参考了不少主题/网站，这里就不一个个列出来了。\n我个人属于简洁主义者~~尽管源码并不简洁~~，所以只实现了自己需要的功能。\njQuery 再见！\n\n> 我真的不擅长写 EJS/JS，语法臃肿以后再改进吧~~或者不改进了~~。\n\n<!-- more -->\n\n### 项目地址\n\n[kwaa/m](https://github.com/kwaa/m)\n\n### 功能说明\n\n#### NPM 安装\n\nHexo 5.0 之后增加了通过 NPM 安装主题的功能，我也想把主题发布到 NPM 上但这和滚动更新的特点不合，所以还是等一段时间吧。\n\n#### 自动暗模式\n\nMDUI 自带（我提了个 issue），在主题里卡片和卡片以外是分开设置的（分别为 theme.mdui.layout 和 theme.m.layout，theme.m.layout 未设置时自动使用 theme.mdui.layout 的值）。\n\n#### 评论\n\n只做了 Utterances。以后加上 Disqus，其他的目前不考虑。\n\n#### PJAX\n\n重写后用的是[MoOx/pjax](https://github.com/MoOx/pjax)，不需要 jQuery。\n没有进度条，因为我觉得淡入淡出效果足够了。\n\n#### Lazyload\n\n能够 loading=\"lazy\" 完事，又何必弄那么麻烦？\n\n#### TOC\n\n放弃了\n\n#### 语法高亮\n\n更新：Hexo 5.0 原生支持 Prism.js。\n所以你只需要在博客的 _config.yml 启用 prism，再在载入主题的 _config.yml 自定义 css 即可。\n\n#### 搜索\n\n自动生成高端大气的 Google 搜索。本地搜索待重写\n\n### 文档\n\n不打算写文档。暂时\n\n### 版本号\n\nTheme-M 不设版本号，如果你是来自未来的其他使用者，你可以把 git pull 当作滚动更新；\n需要注意，我随时可能根据自己的喜好调整/删除任何内容。\n\n### 许可证\n\n我讨厌 GPL 的传染性，所以不会用它。\nMIT？Apache2.0？这些都很好，但我还是想用——\n[WTFPL(Do What The Fuck You Want To Public License)](http://wtfpl.net).\nYou just DO WHAT THE FUCK YOU WANT TO!\n\n### 样式测试\n\n以免麻烦，顺手放在这里。\n\n当你凝视着bug，bug也凝视着你\n不能信任那些Terminal或Editor用白底的人\n\n``` plain\nLorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.\n```\n\n```rust\n#[derive(Debug)]\npub enum State {\n    Start,\n    Transient,\n    Closed,\n}\n\nimpl From<&'a str> for State {\n    fn from(s: &'a str) -> Self {\n        match s {\n            \"start\" => State::Start,\n            \"closed\" => State::Closed,\n            _ => unreachable!(),\n        }\n    }\n}\n```\n\n```json\n[\n  {\n    \"title\": \"apples\",\n    \"count\": [12000, 20000],\n    \"description\": {\"text\": \"...\", \"sensitive\": false}\n  },\n  {\n    \"title\": \"oranges\",\n    \"count\": [17500, null],\n    \"description\": {\"text\": \"...\", \"sensitive\": false}\n  }\n]\n```\n\n```python\n@requires_authorization\ndef somefunc(param1='', param2=0):\n    r'''A docstring'''\n    if param1 > param2: # interesting\n        print 'Gre\\'ater'\n    return (param2 - param1 + 1 + 0b10l) or None\n\nclass SomeClass:\n    pass\n\n>>> message = '''interpreter\n... prompt'''\n```\n\n```html\n<!DOCTYPE html>\n<title>Title</title>\n\n<style>body {width: 500px;}</style>\n\n<script type=\"application/javascript\">\n  function $init() {return true;}\n</script>\n\n<body>\n  <p checked class=\"title\" id='title'>Title</p>\n</body>\n```\n\n```javascript\nfunction $initHighlight(block, cls) {\n  try {\n    if (cls.search(/\\bno\\-highlight\\b/) != -1)\n      return process(block, true, 0x0F) +\n             ` class=\"${cls}\"`;\n  } catch (e) {\n    /* handle exception */\n  }\n  for (var i = 0 / 2; i < classes.length; i++) {\n    if (checkCondition(classes[i]) === undefined)\n      console.log('undefined');\n  }\n\n  return (\n    <div>\n      <web-component>{block}</web-component>\n    </div>\n  )\n}\n\nexport $initHighlight;\n```\n\n```cpp\n#include <iostream>\n\nint main(int argc, char *argv[]) {\n\n  /* An annoying \"Hello World\" example */\n  for (auto i = 0; i < 0xFFFF; i++)\n    cout << \"Hello, World!\" << endl;\n\n  char c = '\\n';\n  unordered_map <string, vector<string> > m;\n  m[\"key\"] = \"\\\\\\\\\"; // this is an error\n\n  return -2e3 + 12l;\n}\n```\n\n```sql\nCREATE TABLE \"topic\" (\n    \"id\" serial NOT NULL PRIMARY KEY,\n    \"forum_id\" integer NOT NULL,\n    \"subject\" varchar(255) NOT NULL\n);\nALTER TABLE \"topic\"\nADD CONSTRAINT forum_id FOREIGN KEY (\"forum_id\")\nREFERENCES \"forum\" (\"id\");\n\n-- Initials\ninsert into \"topic\" (\"forum_id\", \"subject\")\nvalues (2, 'D''artagnian');\n```\n\n```objectivec\n#import <UIKit/UIKit.h>\n#import \"Dependency.h\"\n\n@protocol WorldDataSource\n@optional\n- (NSString*)worldName;\n@required\n- (BOOL)allowsToLive;\n@end\n\n@property (nonatomic, readonly) NSString *title;\n- (IBAction) show;\n@end\n```\n\n```java\n/**\n * @author John Smith <john.smith@example.com>\n*/\npackage l2f.gameserver.model;\n\npublic abstract class L2Char extends L2Object {\n  public static final Short ERROR = 0x0001;\n\n  public void moveTo(int x, int y, int z) {\n    _ai = null;\n    log(\"Should not be called\");\n    if (1 > 5) { // wtf!?\n      return;\n    }\n  }\n}\n```\n\n```swift\nimport Foundation\n\n@objc class Person: Entity {\n  var name: String!\n  var age:  Int!\n\n  init(name: String, age: Int) {\n    /* /* ... */ */\n  }\n\n  // Return a descriptive string for this person\n  func description(offset: Int = 0) -> String {\n    return \"\\(name) is \\(age + offset) years old\"\n  }\n}\n```\n\n```css\n@font-face {\n  font-family: Chunkfive; src: url('Chunkfive.otf');\n}\n\nbody, .usertext {\n  color: #F0F0F0; background: #600;\n  font-family: Chunkfive, sans;\n}\n\n@import url(print.css);\n@media print {\n  a[href^=http]::after {\n    content: attr(href)\n  }\n}\n```\n\n```ruby\n# The Greeter class\nclass Greeter\n  def initialize(name)\n    @name = name.capitalize\n  end\n\n  def salute\n    puts \"Hello #{@name}!\"\n  end\nend\n\ng = Greeter.new(\"world\")\ng.salute\n```\n\n```makefile\n# Makefile\n\nBUILDDIR      = _build\nEXTRAS       ?= $(BUILDDIR)/extras\n\n.PHONY: main clean\n\nmain:\n  @echo \"Building main facility...\"\n  build_main $(BUILDDIR)\n\nclean:\n  rm -rf $(BUILDDIR)/*\n```\n\n```go\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    ch := make(chan float64)\n    ch <- 1.0e10    // magic number\n    x, ok := <- ch\n    defer fmt.Println(`exitting now\\`)\n    go println(len(\"hello world!\"))\n    return\n}\n```\n\n```bash\n#!/bin/bash\n\n###### CONFIG\nACCEPTED_HOSTS=\"/root/.hag_accepted.conf\"\nBE_VERBOSE=false\n\nif [ \"$UID\" -ne 0 ]\nthen\n  echo \"Superuser rights required\"\n  exit 2\nfi\n\ngenApacheConf(){\n  echo -e \"# Host ${HOME_DIR}$1/$2 :\"\n}\n```\n\n```ini\n; boilerplate\n[package]\nname = \"some_name\"\nauthors = [\"Author\"]\ndescription = \"This is \\\na description\"\n\n[[lib]]\nname = ${NAME}\ndefault = True\nauto = no\ncounter = 1_000\n```\n\n# Heading 1\n\n## Heading 2\n\n### Heading 3\n\n#### Heading 4\n\n##### Heading 5\n\n###### Heading 6\n\n---\n\n## Paragraph\n\nLorem ipsum dolor sit amet, [test link]() consectetur adipiscing elit. **Strong text** pellentesque ligula commodo viverra vehicula. *Italic text* at ullamcorper enim. Morbi a euismod nibh. <u>Underline text</u> non elit nisl. ~~Deleted text~~ tristique, sem id condimentum tempus, metus lectus venenatis mauris, sit amet semper lorem felis a eros. Fusce egestas nibh at sagittis auctor. Sed ultricies ac arcu quis molestie. Donec dapibus nunc in nibh egestas, vitae volutpat sem iaculis. Curabitur sem tellus, elementum nec quam id, fermentum laoreet mi. Ut mollis ullamcorper turpis, vitae facilisis velit ultricies sit amet. Etiam laoreet dui odio, id tempus justo tincidunt id. Phasellus scelerisque nunc sed nunc ultricies accumsan.\n\nInterdum et malesuada fames ac ante ipsum primis in faucibus. `Sed erat diam`, blandit eget felis aliquam, rhoncus varius urna. Donec tellus sapien, sodales eget ante vitae, feugiat ullamcorper urna. Praesent auctor dui vitae dapibus eleifend. Proin viverra mollis neque, ut ullamcorper elit posuere eget.\n\n> Praesent diam elit, interdum ut pulvinar placerat, imperdiet at magna.\n\nMaecenas ornare arcu at mi suscipit, non molestie tortor ultrices. Aenean convallis, diam et congue ultricies, erat magna tincidunt orci, pulvinar posuere mi sapien ac magna. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Praesent vitae placerat mauris. Nullam laoreet ante posuere tortor blandit auctor. Sed id ligula volutpat leo consequat placerat. Mauris fermentum dolor sed augue malesuada sollicitudin. Vivamus ultrices nunc felis, quis viverra orci eleifend ut. Donec et quam id urna cursus posuere. Donec elementum scelerisque laoreet.\n\n## List Types\n\n### Definition List (dl)\n\n<dl><dt>Definition List Title</dt><dd>This is a definition list division.</dd></dl>\n\n### Ordered List (ol)\n\n1. List Item 1\n2. List Item 2\n3. List Item 3\n\n### Unordered List (ul)\n\n- List Item 1\n- List Item 2\n- List Item 3\n\n### Checkbox List (ul)\n\n- [ ] List Item 1 unchecked\n- [x] List Item 2 checked\n- [X] List Item 3 checked\n\n## Table\n\n| Table Header 1 | Table Header 2 | Table Header 3 |\n| - | - | - |\n| Division 1 | Division 2 | Division 3 |\n| Division 1 | Division 2 | Division 3 |\n| Division 1 | Division 2 | Division 3 |\n\n## Misc Stuff - abbr, acronym, sub, sup, kbd, etc.\n\nLorem <sup>superscript</sup> dolor <sub>subscript</sub> amet, consectetuer adipiscing elit. Nullam dignissim convallis est. Quisque aliquam. <cite>cite</cite>. Nunc iaculis suscipit dui. Nam sit amet sem. Aliquam libero nisi, imperdiet at, tincidunt nec, gravida vehicula, nisl. Praesent mattis, massa quis luctus fermentum, turpis mi volutpat justo, eu volutpat enim diam eget metus. Maecenas ornare tortor. Donec sed tellus eget sapien fringilla nonummy. <acronym title=\"National Basketball Association\">NBA</acronym> Mauris a ante. Suspendisse quam sem, consequat at, commodo vitae, feugiat in, nunc. Morbi imperdiet augue quis tellus.  <abbr title=\"Avenue\">AVE</abbr>. Use <kbd>Crtl</kbd> + <kbd>C</kbd> to stop.\n\n{% youtube okJ9Vk6owG8 %}\n","tags":["Hexo","Theme-M"],"categories":["折腾"]},{"title":"ID Refresh","url":"/p/id-refresh/","content":"\n经过十个月的考虑~~玩游戏~~时间，我选出了终结过渡期的新 ID。\n\n<!-- more -->\n\n## AB7575DD-9E94-B917-85CD-000D7FEBEAAE\n\n有什么比一串 UUID 更独一无二的呢？\n中间分别是我过渡期间使用的两个 Unicode ID 和 「藍」的 Unicode 编码，前后均来自随机生成。\n\n## 星川 藍 / ほしかわ あい / Hoshikawa AI\n\n给自己取日文名最重要的是什么？不存在重复。这个名字比较重要：作为（有朝一日）归化日本后的使用名。在归化之前仅作为昵称使用。\n\n## xb917 > kwaa\n\n我觉得最麻烦的还要属这个，短字母的撞名几率太大。\nID 可以乱改但域名不能乱改！短即是正义，并且这次我不想加数字了；\n直接从罗马音 Hoshi**k**a**wa** **A**i 里取四个字母，完毕。\n\n## 917.moe > kwaa.dev / kwaa.moe\n\n一个域名变两个域名，双份快乐 & 双份价格。好在都不贵... 不属于 Premium Domains。\n之后博客预计直接使用 kwaa.dev 作为主域名，kwaa.moe 另作它用。\n\n## U.Cor > ./kwaa.dev\n\n简单的修改，标题直接变为域名。\n\n顺便一提，U.Cor 的全称是 Unknown-Corner（未知的小角落），命名来源于 2015 年的我... 2019 年开新博客时没什么好名字，就这么缩短一下用上了。\n","categories":["杂谈"]},{"title":"Project 1ST - 电子分频耳机 DIY 计划","url":"/p/project-1st/","content":"\n## 设计 2020.01 ~\n\n对，我在 Project AXE 被击坠的那段时间有了现在你看到这些东西的想法。\n\nProject 1ST 是由一对六单元耳机头，两条 2.5mm TRRS 对录线和一个普通便携耳放大小的数字信号处理器组成的有源电子分频耳机系统。这个耳机系统不涉及数模转换部分。\n\n<!-- more -->\n\n### 耳机，接口和线材\n\n耳机不内置**普通**的功率分频器，直连2.5mm母座；\n腔体使用透明光固化树脂公模，具备异形 PCB 面板和金属出音嘴。\n（PCB 正面焊盘方便焊接，背面阻焊/焊盘图案算是客制项目之一）\n\n耳机部分我取名为IVX，没有理由。\n\n> IEM-IVX「MASTER」6单元 3分频 3导管\n\n- 38D1XJ007Mi/8a(并联) - 2mm*12mm导音管\n- 33AP007(并联) - 2mm*12mm导音管\n- 2389D(半线圈并联) - 2mm*12mm导音管\n\n模拟信号接口使用 2.5mm TRRS 单输入双输出，另外提供一个 3.5mm TRS 输入。电源开关/交叉反馈开关和音量旋钮。\n\n线材也就是两条编在一起而已，用料暂定 Sommer Cicada 4芯 1.5米。\n\n大概像是这样：\n\n![demo](https://cdn.jsdelivr.net/gh/kwaa/kwaa.github.io/source/_posts/project-1st/demo.png)\n\n2.5mm 插针定义：\n\n![trrs](https://cdn.jsdelivr.net/gh/kwaa/kwaa.github.io/source/_posts/project-1st/trrs.png)\n\n### 模拟信号处理器\n\n> ASP-NE0「MIXER」\n\n这套耳机系统的灵魂也是最麻烦的部分，做这个我觉得有必要使用一部分洞洞板。\n\n交叉反馈、分频点和EQ（如果有）完全根据耳机设计，以实现最佳效果。\n\n仿照 Orion ASP 画的 Function Block Diagram，随进度更新：\n\n![diagram](https://cdn.jsdelivr.net/gh/kwaa/kwaa.github.io/source/_posts/project-1st/diagram.png)\n\n#### IB - 输入缓冲\n\n没想好\n\n#### VC - 音量控制\n\n没想好，暂定 PGA4311？\n\n#### XF - 交叉反馈\n\n不太了解，但我想试试！\n拥有不同的听感不是很棒吗？反正可以手动开关。\n\n#### LR - 三路分频\n\n作为一个 Linkwitz 信徒，我当然会选择四阶 Linkwitz-Riley 滤波器。\n\n打算耳机原型做好以后用 Equalizer APO，foobar2000 和 [foo_dsp_xover](http://xover.sourceforge.net/) 插件先决定好分频点，再根据分频点设计 PCB。\n\n电路直接搬 TI 参考设计 [TIDU035](http://www.ti.com/lit/ug/tidu035/tidu035.pdf)，用 OPA1604 运放。\n\n#### AMP - 功率放大\n\n耳放部分我给起了一个好听的名字—— Mori 森\n\n众木成森，它专为多声道/低功耗设计（实际上也是搬的 TI 参考设计，稍作修改）；一片 INA1620 并联接一端输出。\n\n这次是三分频六声道，所以也就叫 Mori 2X6。\n\n这个放大器为 1ST 耳机系统专用，所以不需要额外的增益开关。\n\n#### POWER - 电源\n\n出于省事，我打算用二或四块 9V 电池供电，并联成 ±9V。\n这样也不用考虑充电了，简洁万岁！\n","tags":["DIY","IEM","入耳式耳机","模拟信号处理器"],"categories":["音频"]},{"title":"白日梦","url":"/p/daydream/","content":"\n所有人或多或少都有那么些想要又买不起的玩意，而对我来说它们出奇的多。\n\n当我不想要或者真的买了，它会被划上删除线。\n<!-- more -->\n\n## STAX SR-009S + DIY MINI T2\n\n当之无愧的耳机顶峰。比起某些卖 111 万甚至 49.8 万的静电耳机（说的就是你，HE1），STAX 不可谓不是静电耳机界的良心。\n\n耳放方面则是 [MINI T2](https://www.head-case.org/forums/topic/13520-diy-mini-t2-build-thread/)，SRM-T2 耳放应该不用我多说了。\n\n## Linkwitz LX521.4\n\nSR009S 在我心里代表耳机的顶峰，而 LX521.4 则是音箱的顶峰。哪怕有很多比它贵的音箱我还是只认它。~~我们除了他谁都不认~~\n\n我一直很崇拜 Linkwitz 老爷子，曾经还想做个 LXmini 但平时不太用音箱也就放弃了... 但或许我以后真的会搞一套 LX521.4。\n\n## Valve Index + 3*Vive Tracker\n\n谁能拒绝一套 VR 设备呢？特别是当你能自己扮纸片人老婆的时候。\n\n这玩意是当下最合适的解决方案，对我来说购买欲应该是上面三个里面最强的（废话其他的都几万块）。\n","categories":["杂谈"]},{"title":"入耳式耳机随想","url":"/p/iem-idea/","content":"\n我把所有的入耳式耳机想法都放在这里，已经实现或正在实际制作的会单独写一篇文章；在这里公开的方案无论是否制作过我都不为实际效果背书。**特别是未实践/早期设计**\n为什么想法这么多却没几个实际动手的？因为没钱。\n\n<!-- more -->\n\n## Project AXE | IEM-AXE「AXE」测试中\n\n> 史诗巨坑，绝赞制作中 2019.07\n\nDIY 耳机的第一步。[Project AXE - 旗舰耳机 DIY 计划](https://kwaa.dev/p/project-axe/)\n\n## Project 1ST | IEM-IVX「MASTER」构思中\n\n> 终极天坑，停留在想法 2020.01\n\n我总是要给自己找麻烦。[Project 1ST - 电子分频耳机 DIY 计划](https://kwaa.dev/p/project-1st)\n\n## IEM-BA4「BASIS」未实践\n\n> 烂大街单元 + 独特分频\n\n想设计一个成本500以内又方便买材料的四单元耳机，于是就有了这玩意。\n\n单边由两个串联 CI-22955 和两个串联 ED-29689 组合，组成四单元双分频双导管。特别在哪里呢？高低频单元都各有一个是半线圈。\n\n由于现在没有闲钱，所以暂时不会进行后续调试。\n\n> IEM-BA4（早期设计）4单元 2分频 2导管\n\n- 22955 + 22955(串联, 半线圈) - 串20Ω, 并10uF - 并管绿阻 - 15mm导管/2mmID\n- 29689 + 29689(串联, 半线圈) - 串10uF - 并管白阻 - 10mm导管/2mmID\n\n## IEM-UN1「UNIVERSAL」已完成/已废弃\n\n> 由于缺乏乐趣~~市面上太多同类~~，此方案不再更新。\n\n2354 便宜了不少，很适合设计新的单动铁。作为我眼里最合适的全频单元，~~或许以后设计 Project 2ND（如果有）的时候也会用到它。~~ 没有 Project 2ND 了\n\n无趣的同时它好做并且声音不差。\n\n> IEM-UN1（最终设计）1单元 1分频 1导管\n\n- 2354 - 串39Ω - 棕阻 - 12mm导管/2mmID\n\n## IEM-BLOOM「BLOOM」构思中\n\n> 现代日呆耳机\n\n大多数时候我都是只想不做，这玩意大概也是一样。\n\nBLOOM 的设计需求是 Galgame / Anisong 专精，所以你可以在它身上找到 334 和 CK100 的一些影子。命名和点兔第三季巧合的重复了，不过我本意是 BLOOM (全屏泛光) 后处理；这也算一种歪打正着吧，毕竟将来测试这玩意的时候肯定会用到点兔角色歌 CD。\n\n低频使用了我喜欢的 38D1XJ007Mi，另设低频衰减开关；中频则为 33AP007。高频使用 30017 和 23991 并联得到中高频 FK 和极高频 WBFK 各两个。30017 和 23991 并联来自 [dhruvmeena96](https://www.head-fi.org/threads/home-made-iems.430688/post-15081696) 的想法，借此获得 20Ω FK / 10Ω WBFK 的直流阻抗。\n\n依然是没钱做不出来，以后再说了。这玩意成本确实高了点，~~以后我可能会再搞一个三单元低配版~~ 参见 IEM-MIDORI。\n\n虽然 30017 容易搞出相位问题，但我就是想试试。之前无意中翻到了说是改进版的 31082，不过只有两根线就没什么意思了。\n\n以 2020 年中旬的淘宝价格，BLOOM 八单元版动铁成本约为 1000 元，十二单元版约为 1500 元。\n\n> IEM-BLOOM_VIII (早期设计) 8单元 4分频 3导管\n\n- 38D1XJ007Mi/8a(并联) - 没想好 - 并管绿阻 - 15mm导管/2mmID\n- 33AP007(并联) - 并管绿阻 - 15mm导管/2mmID\n- TWFK-23991(和30017并联) - FK串22uF - WBFK串470nF - 灰阻 - 15mm导管/2mmID\n- TWFK-30017(和23991并联) - FK串22uF - WBFK串470nF - 白阻 - 10mm导管/2mmID\n\n还可以堆单元数量，像这样：\n\n> IEM-BLOOM_XII（早期设计）12单元 4分频 3导管\n\n- 38D1XJ007Mi/8a(并联) - 没想好 - 并管绿阻 - 15mm导管/2mmID\n- 33AP007(并联) - 并管绿阻 - 15mm导管/2mmID\n- TWFK-23991*2(并联, 和30017并联) - FK串22uF - WBFK串470nF - 灰阻 - 15mm导管/2mmID\n- TWFK-30017*2(并联, 和23991并联) - FK串22uF - WBFK串470nF - 白阻 - 10mm导管/2mmID\n\n## IEM-MIDORI「翠」构思中\n\n> 恶意的政治隐喻\n\n上面（IEM-BLOOM）说的三单元低配 HUFI 特化型耳机。第一个汉字命名！\n为什么叫翠呢？首先是形容它的目标以人声华丽为主；其次是我 2016 年以来一直在祈翠，以这个名字作为一种精神寄托。在这里顺便说一下取名规范吧：\n\n| 姓 | 名 | 字 |\n| - | - | - |\n| IEM | MIDORI | 「翠」 |\n| IEM | AXE | 「AXE」 |\n\n基本思路是延续 CK100 的分频，替换一个更好的低频单元（就是你了，2354！）。原版低频单元 TEC-30033 并没有分频（大概止于 8kHz），这里尝试将 2354 串电阻并电容来压高频。\n\n以 2020 年中旬的淘宝价格，MIDORI 动铁成本约为 300 元。由于我手里有一对剩下的 30017（Project AXE 剩下来的），所以只需要搞定外壳再买一对 2354 就可以开工了。\n\n虽然以 CK100 分频为基础，但我并不想做一个解析强化版 CK100... 主要原因是做不成，毕竟单元都换了。\n\n> IEM-MIDORI（早期设计）3单元 3分频 2导管\n\n- 2354 - 串4.7Ω - 并10uF - 绿阻 - 10mm导管/2mmID\n- TWFK-30017 - FK串22uF - WBFK串0.47uF - 白阻 - 10mm导管/2mmID\n","tags":["DIY","IEM","入耳式耳机"],"categories":["音频"]},{"title":"Project AXE - 旗舰耳机 DIY 计划","url":"/p/project-axe/","content":"\n众所周知，21 世纪的旗舰 IEM 相当昂贵。\n\n我既想拥有一个旗舰 IEM 又认为市售品比起 STAX SR-009S、Abyss 1266 之类的大耳来说溢价过高，就产生了自己设计一个的想法。\n<!-- more -->\n\n既然是旗舰级，那当然要十单元！静电！\n(Balanced)Armature, Electrostatic, X(10)；干脆就叫 AXE 好了。\n\n但是去年的我并不知道，这个玩意会拖了快一年时间还没完成；并且足足让我花了四五千（单元 + 工具）。\n\n## 原型 2019.07 ~\n\nProject AXE 最初方案基本照搬 [dhruvmeena96 的设计](https://www.head-fi.org/threads/home-made-iems.430688/post-15070746)，做了一些小修改和额外加了一个 30017 用来实现类似 CK100 的音染。\n\n> IEM-AXE (ver2019.8) 10单元 5分频 3导管\n\n- 38D1XJ007Mi(串联) - L-pad(4.7Ω, 4.7Ω) - 并管黄阻尼(4700)\n- 33AJ007i(串联) - 串47Ω - 并15uF - 并管黄阻尼(4700)\n- 2389D(半线圈并联) - 串2.2uF - 棕阻尼(1000)\n- EST65DA01(并联) - 串470nF - 并管灰阻尼(320)\n- 30017 - 中频串2.2uF - 高频串470nF - 并管灰阻尼(320)\n\n去年的我画不好分频，焊出来声音有问题然后被人咕了。\n\n之后又摸了半年（直到有钱把工具买齐为止），L-pad 在第一次测试中不可用，我打算修改到一般的低频电阻。\n\n在这期间某宝也能买到 EST65QB02 了，2020 年的 AXE 设计去掉了 30017 并把静电单元改为 EST65QB02，但我并没有钱买新的静电单元(一个七百多呢) 原型只好继续用 EST65DA01，也就是八单元。\n\n## 新生 2020.05 ~\n\n到这里旧 AXE 和新 AXE 已经不是一个东西了。\n我目前更倾向于先把旧 AXE 做完自用，满足我对旗舰入耳式耳机的需求；新 AXE 考虑到预算不足暂且搁置。\n[一年后的成果：STREIN IEM-AXE_P8](https://kwaa.dev/p/project-axe-p8)\n\nIEM-AXE ver2020.9 将中低频改回了并联，并用 RC 低通替代了 L-pad。\n\n> IEM-AXE (ver2020.9) 10单元 4分频 3导管\n\n- 38D1XJ007Mi(并联) - RC低通(串100Ω, 并100uF) - 并管黄阻尼(4700)\n- 33AJ007i(并联) - 并管黄阻尼(4700)\n- 2389D(半线圈并联) - 串2.2uF - 绿阻尼(1500)\n- EST65QB02(并联) - 串470nF - 白阻尼(680)\n\n作为旗舰规格自然要带一个开关，用来调整低频：\n\n- BASS-LIGHT (IEM-AXE_BL, 参考 [Harman IE Target 2019 without bass](https://github.com/jaakkopasanen/AutoEq/blob/master/compensation/harman_in-ear_2019v2_wo_bass.png))\n- BASS-HEAVY (IEM-AXE_BH, 参考 [Harman IE Target 2019](https://github.com/jaakkopasanen/AutoEq/blob/master/compensation/harman_in-ear_2019v2.png))\n\n## 外观\n\n~~面板打算使用某宝买的银箔碎碳板，配正反 STREIN 金属贴；\n腔体透黑+金属出音嘴，这个还是等样品做完之后放成品图吧。~~ 参见 IEM-AXE_P8\n\n## 总结\n\n还没做完怎么就总结了呢？总之我想到什么说什么了。\n\n- 首先，找人帮忙的时候绝对要做好被咕的准备。\n- 其次，直接挑战旗舰是不明智的。\n\n最后是我为了这个计划买的工具：\n\n- 万用表 优利德UT61E ￥270\n- 电烙铁 二手晨美数显T12焊台 ￥150\n- 人工耳 小黑IEC711仿真耳 带底座精密版本+声卡 ￥1000\n- 固化灯 36W镇流器版加强灯+四支LED套装 ￥270\n- 打磨机 世新204+102L ￥250\n\n工具两千左右，单元和其他材料大概有三千。\n\n惨痛的教训：没钱就不要尝试做多动铁耳机！但我买都买了，也只好忍痛做完。\n","tags":["DIY","IEM","入耳式耳机"],"categories":["音频"]},{"title":"S3RVER - 使用 Arch Linux 的 ALL-IN-ONE 服务器","url":"/p/s3rver/","content":"新的一年我终于有预算在家里摆一小只服务器了。\n<!-- more -->\n继 1OCALHOST(平板/笔记本) 和 COMPUTE2(台式机) 后，这是我现有的第三个机器；就叫它S3RVER吧。\n\n## 需求和配置选择\n\n我全都要！不太贵，低功耗，小巧；高性能（相对NAS常用的赛扬奔腾来说）。\n最后选择了R5-2400GE：这是R5-2400G的低功耗版，只有35W TDP。~~AMD yes~~\n\n| 合计 | 2440 |\n| ---- | ---- |\n| 二手 R5-2400GE 准系统 | 1300 |\n| 镁光 16G DDR4-3200 内存条 | 420 |\n| 三星 256G PM981a 固态盘 | 300 |\n| 西数 2T WD20SPZX 机械盘 | 420 |\n\n## 系统安装\n\n我最喜欢的 Arch，装了好几次已经轻车熟路了。\n之前用的都是 EXT4，这次试一试 btrfs\n\n| 分区方案 | | | |\n| ---- | ---- | ---- | ---- |\n| /dev/nvme0n1p1 | 512M | /boot | fat32|\n| /dev/nvme0n1p2 | 238G | / | btrfs |\n| /dev/sda1 | 1.8T | /home | btrfs |\n\n用cfdisk分区，然后格式化并创建子卷：\n\n``` bash\nmkfs.fat -F32 /dev/nvme0n1p1\nmkfs.btrfs -f /dev/nvme0n1p2\nmkfs.btrfs -f /dev/sda1\nmount /dev/nvme0n1p2 /mnt\ncd /mnt\nbtrfs subvol create rootfs\nmkdir -p /mnt/home\nmount /dev/sda1 /mnt/home\ncd /mnt/home\nbtrfs subvol create homefs\n```\n\n接下来挂载子卷：\n\n``` bash\ncd ~\numount /dev/sda1\numount /dev/nvme0n1p2\nmount /dev/nvme0n1p2 /mnt -o subvol=rootfs,compress=lzo,noatime,discard,ssd,space_cache\nmkdir -p /mnt/home\nmount /dev/sda1 /mnt/home -o subvol=homefs,compress-force=lzo,noatime,autodefrag,space_cache\nmkdir -p /mnt/boot\nmount /dev/nvme0n1p1 /mnt/boot\n```\n\n修改mirrorlist，安装系统和生成fstab：\n\n``` bash\nnano /etc/pacman.d/mirrorlist #我就是喜欢用nano\npacman -Syy\npacman -S archlinux-keyring\npacstrap -i /mnt base base-devel linux linux-firmware\ngenfstab -U /mnt >> /mnt/etc/fstab\ncat /mnt/etc/fstab\n```\n\n用arch-chroot进入安装好的系统，安装grub：\n\n``` bash\npacman -S dosfstools grub efibootmgr\ngrub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=arch --recheck\ngrub-mkconfig -o /boot/grub/grub.cfg\n```\n\n安装部分就告一段落了，装个neofetch作为尾声。\n\n``` bash\npacman -S neofetch\nneofetch\n```\n\n## 其他配置\n\n``` bash\npacman -S ufw fail2ban #防火墙\npacman -S zsh grml-zsh-config #zsh&配置\nuseradd -m -g wheel -s zsh b917 #添加用户\npasswd b917 #设置用户密码\n```\n\n### AUR 助手\n\n说到 Arch 的优点，当然少不了 AUR；\n这里我选择了自己常用的yay。\n\n``` bash\ncd /tmp\ngit clone https://aur.archlinux.org/yay.git\ncd yay\nmakepkg -si\n```\n\n### proxychains-ng\n\n活在墙国，免不了要使用代理：我直接设置成台式机的 v2ray SOCKS 端口。\n\n``` bash\npacman -S proxychains-ng\nnano /etc/proxychains.conf\n```\n\n### Docker&Portainer\n\n这次的核心就是 Docker，我会把大多数服务都放进 Docker里运行。Portainer 是 Docker 的图形化管理界面，我用官方文档的方式安装 Portainer，并修改为44301端口。\n\n``` bash\npacman -S docker\nsystemctl start docker\nsystemctl enable docker\ndocker pull portainer/portainer\ndocker volume create portainer_data\ndocker run -d -p 44300:8000 -p 44301:9000 --name=portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer\n```\n\n## 安装在系统的服务\n\n### Samba\n\n> Samba 是 SMB/CIFS 网络协议的重新实现，可以在 Linux 和 Windows 系统间进行文件，打印机共享。\n\nSamba 我用来做什么？当然是放 Steam 游戏！自己电脑的1T机械盘已经快满了。我设置为分享 /home 目录，也就是整个 WD20SPZX。\n\n``` bash\npacman -S samba #安装 Samba\nnano /etc/samba/smb.conf #配置 smb.conf\nsmbpasswd -a b917 #创建用户\nsystmctl start smb nmb #启动服务\nsystemctl enable smb nmb #激活开机自启\n```\n\n我的 smb.conf 配置：\n\n``` ini\n[global]\n    workgroup = WORKGROUP\n    server string = S3RVER Samba %v\n    netbios name = S3RVER\n    log file = /var/log/samba/%m.log\n    log level = 3\n    max log size = 50\n    security = user\n    passdb backend = tdbsam\n[home]\n    comment = Linux home\n    path = /home\n    public = yes\n    writable = yes\n    printable = no\n    valid users = b917\n```\n\n## 安装在 Docker 的服务\n\n### joshava/cloudflare-ddns\n\n本来路由器一直挂着 No-IP.com 的 DDNS，不过域名实在不怎么好看。正好现在有一台 24 小时开机的设备了，就试试 Cloudflare DDNS。\n\n使用之前要先在 Cloudflare - My Profile - API Tokens 创建一个新的 Token，点击 Start with a template 后选择 Edit zone DNS 并设置域名即可。\n\n``` bash\ndocker pull joshava/cloudflare-ddns\ntouch /home/b917/ddns-config.yaml #创建配置文件\nnano /home/b917/ddns-config.yaml #编辑配置文件\ndocker run -d -v /home/b917/ddns-config.yaml:/app/config.yaml hoshava/cloudflare-ddns\n```\n\nconfig.yaml的示例：\n\n``` yaml\nauth:\n    scopedToken: token-input-here\ndomains:\n  - name: foo.example.com\n    type: A\n    proxied: false\n    create: true\n    zoneId: zoneid-input-here\n```","tags":["服务器","Arch Linux"],"categories":["折腾"]},{"title":"非常简单的Oracle对象存储代理","url":"/p/object-storage-workers/","content":"目前可以自定域名和省略path，后续打算加入防盗链和自定HTTP头功能。\n<!-- more -->\n食用方式：复制下面全部代码丢到Workers里，并修改参数\n``` js\naddEventListener(\"fetch\", event => {\n    const host = 'objectstorage.ap-seoul-1.oraclecloud.com'; /* 对象存储的hostname */\n    const path = '/n/xxxxxxxxxxxx/b/standard/o/'; /* 对象存储的pathname */\n    let url = new URL(event.request.url);\n    url.hostname = host;\n    if(!url.pathname.startsWith(path)){\n        if(url.pathname == '/'){\n            return new Response({ status: 403 })\n        }else{\n            url.pathname = path + url.pathname;\n        }\n    }\n    let request = new Request(url, event.request);\n    event.respondWith(\n        fetch(request, {\n            headers: {\n                'Access-Control-Allow-Origin': '*',\n            }\n        })\n    );\n});\n```\n","tags":["对象存储","Oracle Cloud"],"categories":["笔记"]}]